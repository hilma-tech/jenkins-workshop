pipeline {
agent any
environment {
PORT = 8000
}
stages {
stage('build client') {
steps {
    sh '''
script {
echo 'Building Client'
cd ./client
docker build -t itaysdocker .
docker run -name ohana itaysdocker
docker cp ohana:app/build .:server/server/client-build 
'''
}
}
stage('building server') {
steps {
sh '''
cd ../server
echo building docker image
....
docker build -t  itayjenkinsserver .
docker run -d -p8001:8000 -name ohana itayjenkinsserver 
'''
}
}
stage('deploy server') {
steps {
script {
echo 'deploying'
}
}
}

stage('health check') {
steps {
echo 'health check:)'
sh """
wget http://localhost:$PORT/api/health;
if [ \$? = 0 ];
then echo SUCCESS;
else echo FAILED:\\(;
fi
"""
}
}
}
}



pipeline {
agent any
environment {
PORT = 8001
}
stages {
stage('build client') {
steps {
script {
echo 'Building Client'
}
}
}
stage('building server') {
steps {
sh '''
cd server
echo building docker image
....
'''
}
}
stage('deploy server') {
steps {
script {
echo 'deploying'
}
}
}

stage('health check') {
steps {
echo 'health check:)'
sh """
wget http://localhost:$PORT/api/health;
if [ \$? = 0 ];
then echo SUCCESS;
else echo FAILED:\\(;
fi
"""
}
}
}
}

